; PROGRAM LICZACY SILNIE Z LICZBY OD 0 DO 12
; PROGRAM PRZEZNACZONY DO EDYTORA FASM

; Польский факториал :) Чтобы запустить пришлось немного подправить секцию импорта

FORMAT PE CONSOLE    ;TYP PROGRAMU TO PE CONSOLE
ENTRY POCZATEK           ;PUNKT WEJSCIOWY PROGRAMU

include 'win32ax.inc'
; SEKCJA KODU

SECTION '.code' CODE READABLE EXECUTABLE

POCZATEK:

PUSH WITAJ 
call [printf] ; WYSWIETLENIE KOMUNIKATU POWITALNEGO

JESZCZE_RAZ:

PUSH PODAJ_LICZBE
CALL [printf]; WYSWIETLENIE PROSBY PODANIA LICZBY

PUSH LICZB    ; WRZUCAM NA STOS ADRES KOMORKI DOCELOWEJ WPISANIA LICZBY
PUSH INTEGER ; WRZUCAM FORMAT LICZBY INTEGER
CALL [scanf]    ; ODCZYTUJE LICZBE I ZAPISUJE DO PAMIECI

MOV EBX, [LICZB] ; PRZENOSZE LICZBE DO EBX

CMP EBX, 12 ; POROWNUJE Z 12 (JESLI JEST WIEKSZA NIZ 12 TO WYNIK SILNI NIE ZMIESCI SIE NA 32 BITACH)
JG JESZCZE_RAZ

CMP EBX, 0 ; POROWNUJE WARTOSC Z ZEREM (JESLI MNIEJSZA TO JESZCZE RAZ)
JL JESZCZE_RAZ

; WYNIK W BX
        MOV ECX, 0
        MOV ECX, EBX
        MOV EAX, 1
        MOV EBX, 1
        CMP ECX, 2
        JL DALEJ ; JESLI LICZBA MNIEJSZA NIZ 2 TO WYNIK = 1

SILNIA: ; PETLA DOLICZENIA SILNI
        MOV EDX, 0
        MUL EBX ; MNOZE PRZEZ KOLEJNE LICZBY (2,3,4,...)
        INC EBX ; ZWIEKSZAM LICZBE, PRZEZ KTORA MNOZE O JEDEN
        LOOP SILNIA

DALEJ:

; WYNIK W AX
PUSH EAX ; PRZENOSZE 
PUSH WYNIK
CALL [printf] ; WYSWIETLAM WYNIK

        call [getch]

        CALL    [ExitProcess]


; SEKCJA DANYCH


SECTION '.DATA' DATA READABLE WRITEABLE


        PAUZA      DB "PAUSE",0   ; KOMENDA CMD, CZEKA NA KLAWISZ
        WYJDZ      DB "EXIT 0",0  ; KOMENDA CMD, WYCHODZI Z PROGRAMU Z KODEM 0 (BEZ BLEDU)

        INTEGER DB '%i',0
        LICZB RD 1

        WITAJ DB " WITAJ. TEN PROGRAM SLUZY DO OBLICZANIA SILNI.",13,10
                DB " NALEZY WPROWADZIC LICZBE, Z KTOREJ CHCEMY OTRZYMAC SILNIE (0-12).",13,10
                DB " PO WPROWADZENIU NIEPOPRAWNEJ WARTOSCI WPROWADZANIE ZOSTANIE PONOWIONE.",0

        PODAJ_LICZBE DB 13,10,13,10," Z JAKIEJ LICZBY CHCESZ POLICZYC SILNIE? (0-12): ",0

        WYNIK DB 13,10, " SILNIA TEJ LICZBY WYNOSI %i",13,10,0

; SEKCJA DANYCH IMPORTOWANYCH

SECTION '.IDATA' IMPORT DATA READABLE

        library kernel32, 'KERNEL32.DLL',\
                msvcrt, 'msvcrt.dll'

        import msvcrt,\
               printf, 'printf',\
               scanf, 'scanf',\
               getch, '_getch'

        import kernel32,\
               ExitProcess, 'ExitProcess'